---
title: AB Testing in R from Scratch
author: C Ried
date: '2017-09-29'
slug: ab-testing-in-r-from-scratch
categories:
  - r
  - statistics
tags:
  - R
---

#In Progress 


## Using Bayesian Systems

* Quantify the probability of all possibilites thus measuring risk
* insert institutional knowledge (add knowledge that changes the probability)
* learn in an online fashion 


## A/B Testing with Approximate Bayesian Computation 

* No mathematics required 
* able to implement from scratch 


## A/B Testing 
Measures and figures out the better design 

Approximate Bayesian Computation

* Generate a trial value for the thing we want to know (in this case its the conversion fraction of a layout)
* Simulate or data assuming the trail value, keep the trial value, otherwise discard it and try again
* If the simulation looks like the real data, keep the trial value, otherwise discard and try again 
* Keep doing this until we've got lots of trial values that worked 

```{r}
library(progress)
library(foreach)
# Variables 
n_visitors_a <- 100  # number of visitors shown layout A
n_conv_a <- 4        # number of vistors shown layout A who converted (4%)
n_visitors_b <- 40  
n_conv_b <- 2
```

Create the estimate conversion function

```{r}
estimate_conversion <- function(n_visitors, n_conv, trial_conversion, n_estimates = 1000)
{
  i <- 0 
  pb <- progress_bar$new(total = n_estimates)
  estimates <- c()
  while (i < n_estimates) {
    p <- trial_conversion()
    
    n_sim <- simulate_conversion(p, n_visitors)
    if (n_conv == n_sim)
    {
      estimates <- c(estimates, p)
      pb$tick()
      i <- i+1
    }
  }
  estimates
}
```

Helper function to generate random numbers
```{r}
trial_conversion_a <- function()
{
  runif(1,0,1)
}
```

SImulate the conversion rate 
```{r}
simulate_conversion <- function(p, n_visitors)
{
  nsum <- 0 
  for(i in 1:n_visitors) 
  {
    nsum <- nsum + if (runif(1,0,1) < p){1} else {0}
  }
  nsum
}

```

Pulls all the functions above together and creates a histogram of the results 
```{r}
a_estimates <- estimate_conversion(n_visitors_a, n_conv_a, trial_conversion_a)
hist(a_estimates)
```

